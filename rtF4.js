/* copyright Figsh fscss. [ last updated on 23rd of February, 2026] */
function procCntInit(e,n){return`${Array(e).fill().map(((e,s)=>(s+1)*n))}`}function procCnt(e){return e=e.replace(/count\(\s*([\d\.]+)\s*(?:,\s*([\d\.]+)?)?\)/g,((e,n,s)=>(null===s&&(s=1),procCntInit(parseInt(n),parseInt(s||1)))))}function procChe(e){return e=e.replace(/length\((?:([^\)]+)|\s*"([^"]*)"\s*|\s*'([^']*)'\s*)\)/g,((e,n,s,r)=>(n||s||r).length))}function procNum(css){const regex=/num\((.*?)\)/g;function evaluateExpression(expression){try{return eval(expression)}catch(e){return console.error("Invalid expression:",expression),expression}}const processedCSS=css.replace(regex,((e,n)=>evaluateExpression(n)));return processedCSS}const arraysExfscss={},orderedxFscssRandom={},exfMAX_DEPTH=10;function extractBlock(e,n){let s=0,r=n;for(;r<e.length&&("{"===e[r]?s++:"}"===e[r]&&s--,0!==s);)r++;return e.slice(n,r+1)}function parseConditionBlocks(e){const n=[],s=/(if|el-if|el)\s*([^{}]*?)\s*\{([\s\S]*?)\}/g;let r;for(;null!==(r=s.exec(e));)n.push({type:r[1],condition:r[2].trim(),block:r[3].trim()});return n}function procExC(e){let n="";const s=e.replace(/exec\((_log|_error|_warn|_info),\s*(?:"([^"]*)"|'([^']*)'|([^)]*))\)/g,((e,s,r,t,o)=>{const c=r||t||o;return["_log","_error","_warn","_info"].includes(s)?c?(n+=`console.${s.slice(1)}("${c.replace(/"/g,'\\"')}");\n`,""):(console.warn(`fscss[exec(console)]: Empty argument for method: ${s}`),""):(console.warn(`fscss[exec(console)]: Unsupported method: ${s}`),"")}));if(n)try{new Function(n)()}catch(e){console.error("fscss[exec(console)]: Error executing transformed code:",e)}return s}function procEv(e){const n={},s=/@event\s+([\w-]+)\(([^)]*)\)\s*:?{/g;let r,t=e;const o=[];for(;null!==(r=s.exec(e));){const s=r[1],t=r[2],c=r.index+r[0].length-1;if(c>=e.length){console.warn(`fscss[parsing] Warning: Unexpected end of CSS after @event ${s} definition.`);continue}const i=extractBlock(e,c);if(0===i.length||"}"!==i[i.length-1]){console.warn(`fscss[parsing] Warning: Malformed block for @event '${s}'. Missing closing '}'.`);continue}e.slice(r.index,c+i.length);const l=parseConditionBlocks(i),a=t.split(",").map((e=>e.trim())).filter((e=>""!==e));n[s]&&console.warn(`fscss[definition] Warning: Duplicate @event definition for '${s}'. The last one will be used.`),n[s]={args:a,conditionBlocks:l},o.push([r.index,c+i.length])}for(let e=o.length-1;e>=0;e--){const[n,s]=o[e];t=t.slice(0,n)+t.slice(s)}return t=t.replace(/@event\.([\w-]+)\(([^)]*)\)/g,((e,s,r)=>{const t=n[s];if(!t)return console.warn(`fscss[call] Warning: @event function '${s}' not found during call.`),e;const o={},c=r.split(",").map((e=>e.trim())).filter((e=>""!==e));c.length!==t.args.length&&console.warn(`fscss[call] Warning: Argument count mismatch for @event '${s}'. Expected ${t.args.length}, got ${c.length}.`),t.args.forEach(((e,n)=>{void 0!==c[n]?o[e]=c[n]:console.warn(`fscss[call] Warning: Missing value for argument '${e}' in @event '${s}' call.`)}));let i="",l=!1,a=!1;for(const e of t.conditionBlocks)if("el"===e.type&&(a&&console.warn(`fscss[logic] Warning: Multiple 'el' (else) blocks found in @event '${s}'. Only the first 'el' block will be considered.`),a=!0),!l||"el"===e.type){if("el"===e.type){if(l)continue;l=!0}else{const n=e.condition.split(",").map((e=>e.trim())).filter((e=>""!==e));0===n.length?(console.warn(`fscss[logic] Warning: Empty condition in '${e.type}' block for @event '${s}'.`),l=!0):l=n.every((e=>{const n=e.match(/^(\w+)\s*(==|!=|>=|<=|>|<)\s*([^]+)$/);if(!n){const n=e.split(":").map((e=>e.trim()));if(2!==n.length)return console.warn(`fscss[logic] Warning: Malformed condition '${e}' in @event '${s}'. Expected 'variable operator value' or 'variable:value'.`),!1;const[r,t]=n;return r in o?o[r]===t:(console.warn(`fscss[logic] Warning: Condition variable '${r}' not provided in @event '${s}' context. Treating as false.`),!1)}{const[,e,r,t]=n;if(!(e in o))return console.warn(`fscss[logic] Warning: Condition variable '${e}' not provided in @event '${s}' context. Treating as false.`),!1;const c=o[e],i=isNaN(c)?c:Number(c),l=isNaN(t)?t:Number(t);switch(r){case"==":return i==l;case"!=":return i!=l;case">":return i>l;case"<":return i<l;case">=":return i>=l;case"<=":return i<=l;default:return!1}}}))}if(l){const n=e.block.match(/(\w+)\s*(?:\:\s*([^;]*);?|\|([^\|]+)\|?)/);n&&n[2]?i=n[2].trim():n&&n[3]?i=n[3].trim():console.warn(`fscss[logic] Warning: No valid CSS property assignment found in matched block for @event '${s}'. Block content: '${e.block}'.`);break}}return!i&&t.conditionBlocks.length>0&&!l?console.warn(`fscss[call] Warning: No condition matched for @event '${s}' with provided arguments. Returning original call string.`):i||0!==t.conditionBlocks.length||console.warn(`fscss[definition] Warning: @event '${s}' has no condition blocks defined. Returning original call string.`),i||e})),t.trim()}function initlibraries(e){return e=(e=(e=e.replace(/exec\(\s*_init\sisjs\s*\)/g,"exec(https://cdn.jsdelivr.net/gh/fscss-ttr/FSCSS@main/xf/styles/isjs.fscss)")).replace(/exec\(\s*_init\sthemes\s*\)/g,"exec(https://cdn.jsdelivr.net/gh/fscss-ttr/FSCSS@main/xf/styles/trshapes.fthemes.fscss)")).replace(/exec\(_init\sarray1to500\s*\)/g,"exec(https://cdn.jsdelivr.net/gh/fscss-ttr/FSCSS@main/xf/styles/1to500.fscss)")}function procVar(e){return function(e){const n={},s=[],r=e.split("\n");let t=!1;const o={};for(let e=0;e<r.length;e++){let c=r[e].trim();if(c.includes("{")){t=!0,s.push(c);continue}if(c.includes("}")){t=!1;for(const e in o)delete o[e];s.push(c);continue}const i=/^\s*\$([a-zA-Z0-9_-]+)\s*:\s*([^;]+);/,l=c.match(i);if(l){const[,e,r]=l;t?o[e]=r.trim():(n[e]=r.trim(),s.push(c));continue}const a=/\$\/?([a-zA-Z0-9_-]+)(!)?/g;c=c.replace(a,((e,s)=>void 0!==o[s]?o[s]:void 0!==n[s]?n[s]:e)),s.push(c)}return{css:s.join("\n"),getVariable:function(e){return n[e]||null}}}(e).css}function procExt(e){let n={},s=e;return s=s.replace(/("(?:[^"\\]|\\.)*")|('(?:[^'\\]|\\.)*')/g,(function(e){let s=e[0],r=e.slice(1,-1);const t=/@ext\((-?\d+),(\d+):\s*([^)]+)\)/g;let o,c=[];for(;null!==(o=t.exec(r));)c.push({fullMatch:o[0],start:parseInt(o[1]),length:parseInt(o[2]),varName:o[3].trim(),index:o.index});for(let e=c.length-1;e>=0;e--){let s=c[e],t=s.start<0?r.length+s.start:s.start;t=Math.max(0,t);let o=r.substring(t,t+s.length);(t+s.length>r.length||t<0)&&console.warn(`fscss:[@ext]Warning: @ext directive for variable '${s.varName}' in string literal specifies an out-of-bounds range. Extraction may be incomplete or incorrect.`),void 0!==n[s.varName]&&console.warn(`fscss:[@ext]Warning: Duplicate variable name '${s.varName}' found in string literal. The last extracted value will be used.`),n[s.varName]=o,r=r.slice(0,s.index)+r.slice(s.index+s.fullMatch.length)}return s+r+s})),s=s.replace(/([#.\w-]+)\s*@ext\((-?\d+),(\d+):\s*([^)]+)\)/g,(function(e,s,r,t,o){r=parseInt(r),t=parseInt(t),o=o.trim();let c=r<0?s.length+r:r;c=Math.max(0,c);let i=s.substring(c,c+t);return(c+t>s.length||c<0)&&console.warn(`fscss:[@ext]Warning: @ext directive for variable '${o}' on token '${s}' specifies an out-of-bounds range. Extraction may be incomplete or incorrect.`),void 0!==n[o]&&console.warn(`fscss:[@ext]Warning: Duplicate variable name '${o}' found outside string literals. The last extracted value will be used.`),n[o]=i,s})),s=s.replace(/@ext\.(\w+)\!?/g,(function(e,s){return void 0===n[s]?(console.warn(`fscss:[@ext]Warning: Reference to undefined variable '@ext.${s}'. It will not be replaced.`),e):n[s]})),s}function procRan(e){return e.replace(/@random\(\[([^\]]+)\](?:, *ordered)?\)/g,((e,n)=>{const s=/, *ordered\)/.test(e),r=n.split(",").map((e=>e.trim()));if(0===r.length)return console.warn("fscss[@random] Warning: Empty array provided for @random. Returning empty string."),"";if(s){const e=r.join(":");orderedxFscssRandom[e]||(orderedxFscssRandom[e]={values:r,index:0},console.warn(`fscss[@random] Warning: New ordered sequence created for [${n}].`));const s=orderedxFscssRandom[e],t=s.values[s.index%s.values.length];return s.index>=s.values.length&&s.index%s.values.length==0&&console.warn(`fscss[@random] Warning: Ordered sequence [${n}] is looping back to the beginning.`),s.index++,t}return r[Math.floor(Math.random()*r.length)]}))}function procArr(e){const n=/@arr\(?\s*([\w\-_—0-9]+)\)?\[([^\]]+)\]\)?/g;let s;for(;null!==(s=n.exec(e));){const e=s[1],n=s[2].split(",").map((e=>e.trim()));arraysExfscss[e]=n}let r=e;return r=r.replace(/([^\{\}]+)\{\s*([^}]*@arr\.([\w\-_—0-9]+)\[\][^}]*)\s*\}/g,((e,n,s,r)=>{const t=arraysExfscss[r];return t?t.map(((e,t)=>{const o=n.replace(new RegExp(`@arr\\.${r}\\[\\]`,"g"),t+1),c=s.replace(new RegExp(`@arr\\.${r}\\[\\]`,"g"),e);return`${o.trim()} {\n  ${c.trim()}\n}`})).join("\n"):(console.warn(`fscss[@arr] Warning: Array '${r}' not found for loop processing.`),e)})),r=r.replace(/@arr\.([\w\-_—0-9]+)\[(\d+)\]/g,((e,n,s)=>{const r=parseInt(s)-1,t=arraysExfscss[n];return t?void 0!==t[r]?t[r]:e:(console.warn(`fscss[@arr] Warning: Array '${n}' not found.`),e)})),r=r.replace(/@arr\.([\w\-_—0-9]+)(?:\(([^)]*)\))?/g,((e,n,s)=>{const r=arraysExfscss[n];if(!r)return console.warn(`fscss[@arr] Warning: Array '${n}' not found for direct access.`),e;const t=void 0!==s&&""!==s?s:" ";return r.join(t)})),r.replace(n,"").replace(/\n{3,}/g,"\n\n").trim()}function procFun(e){const n={};function s(e){const n={},s=e.split(";");for(let e of s){if(e=e.trim(),!e)continue;const s=e.indexOf(":");if(-1===s){console.warn(`fscss[@fun] Invalid style line (missing colon): "${e}"`);continue}const r=e.substring(0,s).trim(),t=e.substring(s+1).trim();r?n[r]=t:console.warn(`fscss[@fun] Empty property name in line: "${e}"`)}return n}const r=/@fun\(([\w\-\_\—0-9]+)\)\s*\{([\s\S]*?)\}\s*/g;let t;for(;null!==(t=r.exec(e));){const e=t[1],r=t[2].trim();n[e]&&console.warn(`fscss[@fun] Duplicate @fun variable declaration: "${e}". The last one will overwrite previous declarations.`),n[e]={raw:r,props:s(r)}}let o=e;return o=o.replace(/@fun\.([\w\-\_\—0-9]+)\.([\w\-\_\—0-9]+)\.value\!?/g,((e,s,r)=>n[s]&&n[s].props[r]?n[s].props[r]:(console.warn(`fscss[@fun] Value extraction failed for "@fun.${s}.${r}.value". Variable or property not found.`),e))),o=o.replace(/@fun\.([\w\-\_\—0-9]+)\.([\w\-\_\—0-9]+)\!?/g,((e,s,r)=>n[s]&&n[s].props[r]?`${r}: ${n[s].props[r]};`:(console.warn(`fscss[@fun] Single property rule failed for "@fun.${s}.${r}". Variable or property not found.`),e))),o=o.replace(/@fun\.([\w\-\_\—0-9]+)(?=[\s;}])\!?/g,((e,s)=>n[s]?n[s].raw:(console.warn(`[@fun] Full variable block replacement failed for "@fun.${s}". Variable not found.`),e))),o=o.replace(/@fun\(([\w\-\_\d\—]+)\s*\{[\s\S]*?\}\s*/g,""),o=o.replace(/^\s*[\r\n]/gm,""),o=o.trim(),o}function flattenNestedCSS(e,n={}){const{preserveComments:s=!1,indent:r="  ",validate:t=!0,errorHandler:o=(e=>console.warn(e))}=n;function c(e){const[n,...s]=e.split(":").map((e=>e.trim()));return!t||/^(--|[\w-]+)$/.test(n)}function i(e,n,s=""){let t="",o=n;const c=[];let i="",f=!1,p=null,u=0;for(;o<e.length;){const n=e[o];if("\\"===n&&f)i+=n,o++,o<e.length&&(i+=e[o]),o++;else{if('"'!==n&&"'"!==n||f)if(n===p&&f)f=!1,p=null,i+=n;else if("{"!==n||f)if("}"!==n||f){if("@"===n&&!f&&0===u){const n=l(e,o);if(-1===n)break;t+=e.substring(o,n).trim()+"\n\n",o=n;continue}i+=n}else if(u--,0===u){const e=c.pop();if(!e)continue;let n="";n=e.selector.includes("&")?e.selector.replace(/&/g,e.parent):e.parent?`${e.parent} ${e.selector}`:e.selector;const s=a(i,n);(s.properties.length>0||s.keyframes.length>0)&&(t+=`${n} {\n`,s.properties.length>0&&(t+=r+s.properties.join(`;\n${r}`)+";\n"),t+=s.keyframes.join("\n"),t+="}\n\n"),t+=s.nestedBlocks,i=""}else i+=n;else{if(0===u){const e=i.trim();i="",c.push({selector:e,parent:s})}else i+=n;u++}else f=!0,p=n,i+=n;o++}}return{output:t,pos:o}}function l(e,n){let s=0,r=!1,t=null,o=n;for(;o<e.length;){const n=e[o];if("\\"===n&&r)o+=2;else{if('"'!==n&&"'"!==n||r)if(n===t&&r)r=!1,t=null;else if("{"!==n||r){if("}"===n&&!r&&(s--,0===s))return o+1}else s++;else r=!0,t=n;o++}}return-1}function a(e,n){const s={properties:[],nestedBlocks:"",keyframes:[]};let r="",a=!1,f=null,p=0,u=0;for(;u<e.length;){const $=e[u];if("\\"===$&&a)r+=$,u++,u<e.length&&(r+=e[u]),u++;else{if('"'!==$&&"'"!==$||a)if($===f&&a)a=!1,f=null,r+=$;else if("{"!==$||a){if("}"!==$||a)if(";"!==$||a||0!==p){if("@"===$&&!a&&0===p){const n=l(e,u);if(-1===n)break;const t=e.substring(u,n);s.keyframes.push(t.trim()),u=n,r="";continue}r+=$}else{const e=r.trim();e&&(c(e)?s.properties.push(e):t&&o(`Invalid property: ${e}`)),r=""}else if(p--,r+=$,0===p){const e=i(r,0,n).output;s.nestedBlocks+=e,r=""}}else p++,r+=$;else a=!0,f=$,r+=$;u++}}const $=r.trim();return $&&0===p&&(c($)?s.properties.push($):t&&o(`Invalid property: ${$}`)),s}s||(e=e.replace(/\/\*[\s\S]*?\*\//g,"").trim());return i(e,0).output}function procP(e){return e.replace(/%(\d+)\(([^[]+)\[\s*([^\]]+)\]\)/g,((e,n,s,r)=>{const t=s.split(",").map((e=>e.trim()));return t.length!=n?(console.warn(`Number of properties ${t.length} does not match %${n}`),e):t.map((e=>`${e}${r}`)).join("")}))}function transformCssValues(e){const n=new Set,s=e.replace(/(:\s*)(["']?)(.*?)(["']?)\s*copy\(([-]?\d+),\s*([^\;^\)^\(^,^ ]*)\)/g,((e,s,r,t,o,c,i)=>{const l=parseInt(c),a=i.replace(/[^a-zA-Z0-9_-]/g,"");let f="";return f=l>=0?t.substring(0,l):t.substring(t.length+l),n.add(`--${a}:${f};`),`${s}${r}${t}${o}`}));if(n.size>0){return s+`\n${`:root{${Array.from(n).join("\n")}\n}`}`}return s}function repeatString(e,n){return e.replace(/^['"]|['"]$/g,"").repeat(Math.max(0,parseInt(n)))}function replaceRe(e){const n=new Map;let s,r=e.replace(/(?:store|str|re)\(\s*([^:,]+)\s*[,:]\s*(?:"([^"]*)"|'([^']*)')\s*\)/gi,((e,s,r,t)=>{const o=r||t;return s=s.trim(),n.set(s,o),""}));if(0===n.size)return r;let t=0;let o=r;do{s=!1;for(const[e,r]of n.entries()){const n=new RegExp(`\\b${escapeRegExp(e)}\\b`,"g"),t=o.replace(n,r);t!==o&&(s=!0,o=t)}t++}while(s&&t<100);return t>=100&&console.warn("Maximum iterations reached. Possible circular dependency."),o}function escapeRegExp(e){return e.replace(/[.*+?^${}|[\]\\]/g,"\\$&")}function vfc(e){return e=e.replace(/([\w-]+:\s*)(\$\/?[\w-]+!?)(\s*\|\|\s*([^\n\};]+))?/g,((e,n,s,r,t)=>/^\$\/[\w-]+!?$/.test(s)?(s.endsWith("!")&&t&&console.warn(`fscss[VFC]: Required variable "${s}" should not have fallback (${t})`),r&&!t?.trim()?(console.warn(`fscss[VFC]: Empty fallback in -> ${e}`),e):(t?.includes("$/")&&!/^\$\/[\w-]+!?$/.test(t.trim())&&console.warn(`fscss[VFC]: Invalid fallback variable syntax -> ${t}`),t?`${n}${t.trim()};${n}${s}`:`${n}${s}`)):(console.warn(`fscss[VFC]: Invalid variable escape syntax -> ${s} at ${e}`),e)))}function applyFscssTransformations(e){return e=(e=procP(e=e.replace(/(?:mxs|\$p)\((([^\,]*)\,)?(([^\,]*)\,)?(([^\,]*)\,)?(([^\,]*)\,)?(([^\,]*)\,)?(([^\,]*)\,\s*)?("([^"]*)"|'([^']*)')\)/gi,"$2:$14$15;$4:$14$15;$6:$14$15;$8:$14$15;$10:$14$15;$12:$14$15;").replace(/(?:mx|\$m)\((([^\,]*)\,)?(([^\,]*)\,)?(([^\,]*)\,)?(([^\,]*)\,)?(([^\,]*)\,)?(([^\,]*)\,\s*)?("([^"]*)"|'([^']*)')\)/gi,"$2$14$15$4$14$15$6$14$15$8$14$15$10$14$15$12$14$15").replace(/rpt\((\d+)\,\s*("([^"]*)"|'([^']*)')\)/gi,((e,n,s)=>repeatString(s,n))).replace(/\$(([\_\-\d\w]+)\:(\"[^\"]*\"|\'[^\']*\'|[^\;]*)\;)/gi,":root{--$1}").replace(/\$([^\!\s]+)!/gi,"var(--$1)").replace(/\$([\w\-\_\d]+)/gi,"var(--$1)").replace(/\-\*\-(([^\:]+)\:(\"[^\"]*\"|\'[^\']*\'|[^\;]*)\;)/gi,"-webkit-$1-moz-$1-ms-$1-o-$1").replace(/%i\((([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\]\[]*)\,)?(([^\,\]\[]*)\,)?(([^\,\[\]]*))?\s*\[([^\]\[]*)\]\)/gi,"$2$21$4$21$6$21$8$21$10$21$12$21$14$21$16$21$18$21$20$21").replace(/%6\((([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\]\[]*)\,)?(([^\,\]\[]*)\,)?(([^\,\[\]]*))?\s*\[([^\]\[]*)\]\)/gi,"$2$13$4$13$6$13$8$13$10$13$12$13").replace(/%5\((([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\]\[]*)\,)?(([^\,\]\[]*))?\s*\[([^\]\[]*)\]\)/gi,"$2$11$4$11$6$11$8$11$10$11").replace(/%4\((([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*))?\s*\[([^\]\[]*)\]\)/gi,"$2$9$4$9$6$9$8$9").replace(/%3\((([^\,\[\]]*)\,)?(([^\,\[\]]*)\,)?(([^\,\[\]]*))?\s*\[([^\]\[]*)\]\)/gi,"$2$7$4$7$6$7").replace(/%2\((([^\,\[\]]*)\,)?(([^\,\]\[]*))?\s*\[([^\]\[]*)\]\)/gi,"$2$5$4$5").replace(/%1\((([^\,\]\[]*))?\s*\[([^\]\[]*)\]\)/gi,"$2$3"))).replace(/\$\(\s*@keyframes\s*(\S+)\)/gi,"$1{animation-name:$1;}@keyframes $1").replace(/\$\(\s*(\@[\w\-\*]*)\s*([^\{\}\,&]*)(\s*,\s*[^\{\}&]*)?&?(\[([^\{\}]*)\])?\s*\)/gi,"$2$3{animation:$2 $5;}$1 $2").replace(/\$\(\s*--([^\{\}]*)\)/gi,"$1").replace(/\$\(([^\:]*):\s*([^\)\:]*)\)/gi,"[$1='$2']").replace(/g\(([^"'\s]*)\,\s*(("([^"]*)"|'([^']*)')\,\s*)?("([^"]*)"|'([^']*)')\s*\)/gi,"$1 $4$5$1 $7$8").replace(/\$\(([^\:]*):\s*([^\)\:]*)\)/gi,"[$1='$2']").replace(/\$\(([^\:^\)]*)\)/gi,"[$1]")}async function impSel(e){const n=[".fscss",".css",".txt",".scss",".less","xfscss"],s=[...e.matchAll(/@import\(exec\(([^)]+)\)\s*\.\s*(?:pick|find)\(([^)]+)\)\)/g)];let r=e;for(const e of s){const[s,t,o]=e;try{const e=t.replace(/["']/g,""),c=e.slice(e.lastIndexOf(".")).toLowerCase();if(e.trim().startsWith("_init")&&e.includes(" "))return void console.warn(`fscss[@import] library not found for: ${e}`);if(!n.includes(c))return void console.warn(`fscss[@import] invalid extension for: ${e}`);const i=await fetch(e);if(!i.ok)throw new Error(`fscss[@import] HTTP ${i.status} for ${t}`);const l=extractOnlyBlock(await i.text(),o.trim());r=r.replace(s,l)}catch(e){console.error(`fscss[@import]  Failed: ${t} `,e),r=r.replace(s,`/* Failed import: ${t} */`)}}return r}function extractOnlyBlock(e,n){const s=new RegExp(`${n}\\s*{[^}]*}`,"g"),r=e.match(s);return r?r.join("\n"):console.warn(`fscss[@import pick] No block matches: ${n} `)}const VALID_EXTENSIONS=[".fscss",".css",".txt",".scss",".less",".xfscss"];async function processImports(e,n=0,s=window.location.href){if(n>exfMAX_DEPTH)return console.warn("fscss[@import]\n Maximum import depth exceeded. Skipping further imports."),e;const r=Array.from(e.matchAll(/@import\s*\(\s*exec\s*\(\s*((?:'[^']*'|"[^"]*"|[^'")]\S*)\s*)\)\s*\)/g));if(0===r.length)return e;const t=await Promise.all(r.map((async e=>{const[r,t]=e;try{const e=t.replace(/^['"](.*)['"]$/,"$1").trim(),r=new URL(e,s).href,o=new URL(r).pathname,c=o.slice(o.lastIndexOf(".")).toLowerCase();if(r.trim().startsWith("_init")&&r.includes(" "))return void console.warn(`fscss[@import] library not found for: ${r}`);if(!VALID_EXTENSIONS.includes(c))return console.warn(`fscss[@import] \n Invalid import URL extension "${c}" for "${r}". Only ${VALID_EXTENSIONS.join(", ")} are allowed.`),`/* Invalid extension for "${r}" */`;const i=await fetch(r);if(!i.ok)throw new Error(`HTTP ${i.status} for ${r}`);return processImports(await i.text(),n+1,r)}catch(e){return console.warn(`fscss[@import]\n Failed to import "${t}" from "${s}":`,e),`/* Error importing "${t}": ${e.message} */`}})));let o=0,c="";return r.forEach(((n,s)=>{c+=e.slice(o,n.index),c+=t[s],o=n.index+n[0].length})),c+=e.slice(o),c}async function procImp(e){try{return await processImports(e)}catch(n){return console.warn("fscss[]\n Processing failed:",n),console.warn("fscss[@import] Warning: can't resolve imports"),e}}async function processStyles(){const e=document.querySelectorAll("style");if(e.length)for(const n of e){let e=n.textContent;e.includes("exec.obj.block(all)")||(e.includes("exec.obj.block(init lab)")||(e=initlibraries(e)),e.includes("exec.obj.block(f import)")&&e.includes("exec.obj.block(f import pick)")||(e=await impSel(e)),e.includes("exec.obj.block(f import)")||(e=await procImp(e)),e.includes("exec.obj.block(init lab)")&&!e.includes("exec.obj.block(exInit lab)")||(e=initlibraries(e)),e.includes("exec.obj.block(f import)")&&e.includes("exec.obj.block(f import pick)")||(e=await impSel(e)),e.includes("exec.obj.block(f import)")||(e=await procImp(e)),e.includes("exec.obj.block(vfc)")||(e=vfc(e)),e.includes("exec.obj.block(store:before)")&&e.includes("exec.obj.block(store)")||(e=replaceRe(e)),e.includes("exec.obj.block(ext:before)")&&e.includes("exec.obj.block(ext)")||(e=procExt(e)),e.includes("exec.obj.block(f var)")||(e=procVar(e)),e.includes("exec.obj.block(fun)")||(e=procFun(e)),e.includes("exec.obj.block(length)")||(e=procChe(e)),e.includes("exec.obj.block(count)")||(e=procCnt(e)),e.includes("exec.obj.block(arr)")||(e=procArr(e)),e.includes("exec.obj.block(event)")||(e=procEv(e)),e.includes("exec.obj.block(random)")||(e=procRan(e)),e.includes("exec.obj.block(copy)")||(e=transformCssValues(e)),e.includes("exec.obj.block(store:after)")&&e.includes("exec.obj.block(store)")||(e=replaceRe(e)),e.includes("exec.obj.block(num)")||(e=procNum(e)),e.includes("exec.obj.block(ext:after)")&&e.includes("exec.obj.block(ext)")||(e=procExt(e)),e.includes("exec.obj.block(t group)")||(e=applyFscssTransformations(e)),e.includes("exec.obj.block(length)")||(e=procChe(e)),e.includes("exec.obj.block(count)")||(e=procCnt(e)),e.includes("exec.obj.block(debug)")||(e=procExC(e))),e=e.replace(/exec\.obj\.block\([^\)\n]*\)\;?/g,""),n.innerHTML=e}else console.warn("fscss[Obj]\n No <style> elements found.")}function processDrawElements(){document.querySelectorAll(".draw").forEach((e=>{const n=e.style.color||"#000";e.style.color="transparent",e.style.webkitTextStroke=`2px ${n}`}))}(async()=>{try{await processStyles(),await processDrawElements()}catch(e){console.error("Error processing styles or draw elements:",e)}})();
